<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>115年度 ESG 評鑑自評系統</title>
    
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 設定 Import Map -->
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.344.0"
            }
        }
    </script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* 打字機效果游標 */
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); } 
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans antialiased">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { FileText, CheckCircle, XCircle, TrendingUp, Save, Download, Info, Search, Upload, Sprout, Users, Scale, ShieldAlert, BookOpen, LogOut, MessageCircle, X, Bot, HardDriveDownload, DownloadCloud } from 'lucide-react';

        // --- 內建新版 CSV 範本 (無前屆編號) ---
        const OFFICIAL_TEMPLATE_CSV = `編號,評鑑指標,題型,指標說明（註）,評鑑資訊依據（註）
E-1,"公司是否制定溫室氣體減量管理政策，包含減量目標、推動措施及達成情形等？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司主動積極關切氣候變遷議題，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第17條第3項規定，上市上櫃公司宜統計溫室氣體排放量、用水量及廢棄物總重量，並制定節能減碳、溫室氣體減量、減少用水或其他廢棄物管理之政策，及將碳權之取得納入公司減碳策略規劃中，且據以推動，以降低公司營運活動對氣候變遷之衝擊；聯合國永續發展目標第12項，確保永續消費及生產模式；同目標第13項，採取緊急措施以因應氣候變遷及其影響。\n【符合評鑑指標基本得分要件者於本構面計分；若揭露2030年減碳目標、策略及行動計畫，則總分另加一分。】",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞溫室氣體排放，為評鑑資訊依據。
E-2,"公司是否揭露過去兩年溫室氣體範疇一及範疇二年排放量？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司重視環境議題並揭露相關數據，以逐步達成減緩全球暖化之目標，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第17條第3項規定，上市上櫃公司宜統計溫室氣體排放量、用水量及廢棄物總重量，並制定節能減碳、溫室氣體減量、減少用水或其他廢棄物管理之政策，及將碳權之取得納入公司減碳策略規劃中，且據以推動，以降低公司營運活動對氣候變遷之衝擊。\n【符合評鑑指標基本得分要件者於本構面計分；若過去兩年溫室氣體範疇一及範疇二年排放量取得外部驗證者，則總分另加一分。】",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞溫室氣體排放，為評鑑資訊依據。
E-3,公司是否揭露過去一年溫室氣體範疇三類別及年排放量？,A,"一、為鼓勵公司重視環境議題並揭露相關數據，以逐步達成減緩全球暖化之目標，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第17條第3項規定，上市上櫃公司宜統計溫室氣體排放量、用水量及廢棄物總重量，並制定節能減碳、溫室氣體減量、減少用水或其他廢棄物管理之政策，及將碳權之取得納入公司減碳策略規劃中，且據以推動，以降低公司營運活動對氣候變遷之衝擊。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞溫室氣體排放，為評鑑資訊依據。
E-4,"公司是否制定並揭露減少用水管理政策，包含減量目標、推動措施及達成情形等？\n",A,"一、為鼓勵公司重視水資源議題，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第17條第3項規定，上市上櫃公司宜統計溫室氣體排放量、用水量及廢棄物總重量，並制定節能減碳、溫室氣體減量、減少用水或其他廢棄物管理之政策，及將碳權之取得納入公司減碳策略規劃中，且據以推動，以降低公司營運活動對氣候變遷之衝擊；聯合國永續發展目標第6項，確保所有人都能享有水及衛生及其永續管理。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞水資源管理，為評鑑資訊依據。
E-5,公司是否揭露過去兩年用水量？,A,"一、為鼓勵公司重視水資源議題並揭露相關數據，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第17條第3項規定，上市上櫃公司宜統計溫室氣體排放量、用水量及廢棄物總重量，並制定節能減碳、溫室氣體減量、減少用水或其他廢棄物管理之政策，及將碳權之取得納入公司減碳策略規劃中，且據以推動，以降低公司營運活動對氣候變遷之衝擊。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞水資源管理，為評鑑資訊依據。
E-6,公司是否制定並揭露推動循環經濟或廢棄物管理之政策及相關作為？,A,"一、為鼓勵公司重視廢棄物管理議題，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第17條第3項規定，上市上櫃公司宜統計溫室氣體排放量、用水量及廢棄物總重量，並制定節能減碳、溫室氣體減量、減少用水或其他廢棄物管理之政策，及將碳權之取得納入公司減碳策略規劃中，且據以推動，以降低公司營運活動對氣候變遷之衝擊；聯合國永續發展目標第12項，確保永續消費及生產模式。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞廢棄物管理，為評鑑資訊依據。
E-7,公司是否揭露過去兩年廢棄物總重量？,A,"一、為鼓勵公司重視廢棄物管理議題並揭露相關數據，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第17條第3項規定，上市上櫃公司宜統計溫室氣體排放量、用水量及廢棄物總重量，並制定節能減碳、溫室氣體減量、減少用水或其他廢棄物管理之政策，及將碳權之取得納入公司減碳策略規劃中，且據以推動，以降低公司營運活動對氣候變遷之衝擊。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞廢棄物管理，為評鑑資訊依據。
E-8,"公司是否制定並揭露能源管理計畫及其執行情形？\n【額外加分要件請詳指標說明】",A+,"一、為提升能源使用效率，鼓勵公司制定能源管理計畫，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第14條規定，上市上櫃公司應致力於提升能源使用效率，並制定相關管理計畫。\n【符合評鑑指標基本得分要件者於本構面計分；若導入ISO 50001或類似之能源管理系統標準，並取得第三方驗證，則總分另加一分。】",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞能源管理，為評鑑資訊依據。
E-9,公司是否揭露過去兩年能源使用狀況？,A,一、為鼓勵公司揭露能源使用狀況，爰訂定本指標。,"本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞能源管理，為評鑑資訊依據。\n"
E-10,公司是否揭露發行或投資永續發展債券之情形？,A,"一、為鼓勵公司將資金投入環境或社會效益之投資計畫，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第14條規定，上市上櫃公司宜評估氣候變遷對公司現在及未來之潛在風險與機會，並採取相關因應措施。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞永續金融，為評鑑資訊依據。
E-11,公司是否參考國際財務報導準則第S2號（IFRS S2）架構，揭露企業對氣候相關風險與機會之治理情況、策略、風險管理、指標和目標之相關資訊？,A,"一、為鼓勵公司揭露氣候相關資訊，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第10條規定，上市上櫃公司應依相關規定及公司產業特性，進行與公司營運相關之環境、社會及公司治理議題之風險評估，並訂定相關風險管理政策或策略。",本指標以公開資訊觀測站－ESG數位平台＞永續報告書，為評鑑資訊依據。
E-12,公司是否導入內部碳定價，以估算氣候變遷對公司財務業務之影響？,A,"一、為將氣候風險納入營運決策，鼓勵公司導入內部碳定價機制，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第14條規定，上市上櫃公司宜評估氣候變遷對公司現在及未來之潛在風險與機會，並採取相關因應措施.","本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞溫室氣體排放，為評鑑資訊依據。\n"
E-13,"公司是否制定並揭露環境管理制度及其執行情形？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司建立合適之環境管理制度，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第17條規定，上市上櫃公司應訂定合適之環境管理制度。\n【符合評鑑指標基本得分要件者於本構面計分；若獲得ISO 14001或類似之環境管理系統驗證，則總分另加一分。】",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞環境管理，為評鑑資訊依據。
E-14,公司是否訂定並揭露生物多樣性政策或承諾，並說明實施情形？,A,"一、為鼓勵公司重視生物多樣性議題，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第17條第3項規定，上市上櫃公司宜關注氣候變遷對營運活動之影響，並依營運狀況與溫室氣體盤查結果，制定公司節能減碳及溫室氣體減量策略，且將碳權之取得納入公司減碳策略規劃中，並據以推動，以降低公司營運活動對氣候變遷之衝擊；聯合國永續發展目標第15項，保育及永續利用陸域生態系，確保生物多樣性並防止土地劣化。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞自然資源，為評鑑資訊依據。
E-15,公司是否訂定並揭露推動自然碳匯之策略與措施，並說明實施情形？,A,"一、為鼓勵公司重視自然碳匯議題，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第17條第3項規定，上市上櫃公司宜關注氣候變遷對營運活動之影響，並依營運狀況與溫室氣體盤查結果，制定公司節能減碳及溫室氣體減量策略，且將碳權之取得納入公司減碳策略規劃中，並據以推動，以降低公司營運活動對氣候變遷之衝擊；聯合國永續發展目標第13項，採取緊急措施以因應氣候變遷及其影響。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞自然資源，為評鑑資訊依據。
E-16,公司是否揭露所制定之供應商管理政策，要求供應商在環保等議題遵循相關規範，並說明實施情形？,A,"一、為提升供應鏈之環境永續管理，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第29條規定，上市上櫃公司應訂定供應商管理政策，要求供應商在環保、職業安全衛生或勞動人權等議題遵循相關規範。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞供應鏈管理，為評鑑資訊依據。
S-1,公司是否參考國際人權公約，制訂保障人權政策，並揭露政策內容及權責單位？,A,"一、為鼓勵公司重視人權議題，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第18條規定，上市上櫃公司應遵守相關法規，並遵循國際人權公約，制定保障人權政策.","本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞人權管理，為評鑑資訊依據。\n"
S-2,"公司是否訂定並揭露人權盡職調查流程及其執行情形？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司落實人權保障，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第18條規定，上市上櫃公司應遵守相關法規，並遵循國際人權公約，制定保障人權政策。\n【符合評鑑指標基本得分要件者於本構面計分；若將人權盡職調查範圍擴及供應鏈，則總分另加一分。】",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞人權管理，為評鑑資訊依據。
S-3,公司是否評估對社區之風險或機會且採行相應措施，並揭露其具體採行措施與實施成效？,A,"一、為鼓勵公司重視社區議題，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第26條規定，上市上櫃公司應評估公司經營對社區之影響，並適當聘用公司營運所在地之人力，以增進社區認同。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞社會公益，為評鑑資訊依據。
S-4,公司是否投入資源支持國內文化發展，並揭露支持方式與成果？,A,"一、為鼓勵公司支持文化發展，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第27條規定，上市上櫃公司宜透過捐贈、贊助、投資、採購或志願服務等方式，支持國內文化發展。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞社會公益，為評鑑資訊依據。
S-5,"公司是否揭露所辨別之利害關係人身份、關注議題、溝通管道與回應方式？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司重視利害關係人權益，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第11條規定，上市上櫃公司應辨識利害關係人，並於公司網站設置利害關係人專區；透過適當溝通管道，了解利害關係人之合理期望及需求，並妥適回應其所關注之重要永續發展議題。\n【符合評鑑指標基本得分要件者於本構面計分；若將與各利害關係人溝通情形報告至董事會，並揭露報告之頻率（至少一年一次）或當年度向董事會報告之日期，則總分另加一分。】",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞利害關係人溝通，為評鑑資訊依據。
S-6,公司是否揭露與投資人議合（如法人說明會、親自拜訪、視訊、電話或電子郵件等方式）之情形，及投資人提問與公司回復之重要內容？,A,"一、為鼓勵公司重視投資人溝通，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第13條規定，上市上櫃公司應建立與投資人溝通之管道及機制。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞利害關係人溝通，為評鑑資訊依據。
S-7,公司是否設置推動企業誠信經營專（兼）職單位，負責誠信經營政策與防範方案之制訂及監督執行，並說明設置單位之運作及執行情形，且至少一年一次向董事會報告？,A,"一、為建立誠信經營之企業文化，鼓勵公司設置推動企業誠信經營專（兼）職單位，負責誠信經營政策與防範方案之制訂及監督執行，並定期向董事會報告，爰訂定本指標。\n二、指標參考：上市上櫃公司誠信經營守則第15條規定，上市上櫃公司之董事會應盡善良管理人之注意義務，督促公司防止不誠信行為，並隨時檢討其實施成效及持續改進，確保誠信經營政策之落實。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞誠信經營，為評鑑資訊依據。
S-8,公司是否揭露經董事會通過之誠信經營政策，明訂具體作法與防範不誠信行為方案，並說明履行情形？,A,"一、為建立誠信經營之企業文化，鼓勵公司揭露經董事會通過之誠信經營政策，爰訂定本指標。\n二、指標參考：上市上櫃公司誠信經營守則第16條規定，上市上櫃公司應建立不誠信行為風險之評估機制，定期分析及評估營業範圍內具較高不誠信行為風險之營業活動，並據以訂定防範不誠信行為方案。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞誠信經營，為評鑑資訊依據。
S-9,公司是否訂定並詳細於公司網站揭露公司內、外部人員對於不合法（包括貪汙）與不道德行為的檢舉制度？,A,"一、為建立誠信經營之企業文化，鼓勵公司建立檢舉制度，爰訂定本指標。\n二、指標參考：上市上櫃公司誠信經營守則第23條規定，上市上櫃公司應訂定具體檢舉及獎勵制度，並建立便利之檢舉管道，且對檢舉人身分及檢舉內容應予保密。",本指標以公司網站為評鑑資訊依據。
S-10,"公司是否制訂並揭露與營運目標連結之智慧財產管理計畫及其執行情形，且至少一年一次向董事會報告？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司重視智慧財產管理，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第37條之2規定，上市上櫃公司宜訂定與營運目標連結之智慧財產管理計畫，並揭露其執行情形，且定期（至少一年一次）向董事會報告。\n【符合評鑑指標基本得分要件者於本構面計分；若取得台灣智慧財產管理制度（TIPS）驗證或其他類似之智慧財產管理系統驗證，則總分另加一分。】",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞智慧財產權管理，為評鑑資訊依據。
S-11,公司是否投資國內創新型新創事業，並揭露相關投資情形？ ,A,"一、為鼓勵公司投資國內創新型新創事業，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第27條規定，上市上櫃公司宜透過捐贈、贊助、投資、採購或志願服務等方式，支持國內文化發展。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞社會公益，為評鑑資訊依據。
S-12,"公司是否建置並揭露資通安全風險管理架構、資通安全政策、具體管理方案及投入資通安全管理之資源？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司重視資通安全管理，爰訂定本指標。\n二、指標參考：上市上櫃公司資通安全管控指引第4條規定，上市上櫃公司應配置適當人力資源及設備，進行資通安全制度之規劃、監控及執行資通安全管理作業。\n【符合評鑑指標基本得分要件者於本構面計分；若取得ISO 27001、CNS 27001或其他資通安全管理系統驗證，則總分另加一分。】",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞資通安全管理，為評鑑資訊依據。
S-13,公司是否制定並揭露產品與服務之消費者權益政策及申訴程序？,A,"一、為鼓勵公司重視消費者權益，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第24條規定，上市上櫃公司對產品與服務之行銷及標示，應遵循相關法規與國際準則，不得有欺騙、誤導、詐欺或任何其他破壞消費者信任、損害消費者權益之行為。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞消費者權益，為評鑑資訊依據。
S-14,公司是否制定並揭露產品與服務之顧客隱私及個人資料保護政策與申訴程序？,A,"一、為鼓勵公司重視顧客隱私及個人資料保護，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第25條規定，上市上櫃公司應尊重消費者之隱私權，保護消費者提供之個人資料，並採行適當之保護措施。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞消費者權益，為評鑑資訊依據。
S-15,公司是否揭露所制定之供應商管理政策，要求供應商在職業安全衛生、勞動人權、資通訊安全或隱私權保護等議題遵循相關規範，並說明實施情形？,A,"一、為鼓勵公司重視供應鏈管理，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第29條規定，上市上櫃公司應訂定供應商管理政策，要求供應商在環保、職業安全衛生或勞動人權等議題遵循相關規範。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞供應鏈管理，為評鑑資訊依據。
S-16,"公司是否揭露各項員工福利措施、退休制度與其實施情形？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司重視員工福利，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第21條規定，上市上櫃公司應提供員工資訊，並建立員工申訴機制，以維護員工之合法權益。\n【符合評鑑指標基本得分要件者於本構面計分；若實施員工持股信託，則總分另加一分。】",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞員工福利，為評鑑資訊依據。
S-17,"公司是否提供友善婚育或家庭照顧之職場環境與措施，並說明實施情形與成效？\n",A,"一、為鼓勵公司重視員工家庭照顧，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第21條規定，上市上櫃公司應提供員工資訊，並建立員工申訴機制，以維護員工之合法權益。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞員工福利，為評鑑資訊依據。
S-18,公司是否制訂並揭露政策，將經營績效或成果，適當反映在員工薪酬？,A,"一、為鼓勵公司將經營成果回饋員工，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第29條規定，上市上櫃公司應依公司法及章程規定，訂定員工酬勞分派之成數。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞員工福利，為評鑑資訊依據。
S-19,公司是否揭露員工人身安全與工作環境之保護措施與其實施情形？,A,"一、為鼓勵公司重視員工安全與健康，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第22條規定，上市上櫃公司應提供員工安全與健康之工作環境，並定期對員工實施安全與健康教育訓練。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞職業安全衛生，為評鑑資訊依據。
S-20,公司是否制定職場多元化或推動性別平等政策，並揭露其實施情形？,A,"一、為鼓勵公司重視職場多元化與性別平等，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第20條規定，上市上櫃公司應建立員工多元化政策，並揭露其執行情形，且定期（至少一年一次）向董事會報告。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞人權管理，為評鑑資訊依據。
S-21,公司是否制定提升員工職涯能力之員工培訓發展計畫，並揭露內容及其實施情形？,A,"一、為鼓勵公司重視員工職涯發展，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第23條規定，上市上櫃公司應建立員工職涯發展計畫，並定期檢討其實施成效。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞員工進修訓練，為評鑑資訊依據。
S-22,公司是否定期進行員工意見調查，並揭露其實施情形及改善計畫？,A,"一、為鼓勵公司重視員工意見，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第21條規定，上市上櫃公司應提供員工資訊，並建立員工申訴機制，以維護員工之合法權益。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞勞資關係，為評鑑資訊依據。
S-23,公司是否依性別及年齡揭露過去兩年員工離職率，並說明其變化趨勢與原因？,A,"一、為鼓勵公司重視員工離職率，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第21條規定，上市上櫃公司應提供員工資訊，並建立員工申訴機制，以維護員工之合法權益。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞勞資關係，為評鑑資訊依據。
G-1,公司是否於股東常會報告董事領取之酬金，包含酬金政策、個別酬金內容、數額及與績效評估結果之關聯性？,A,"一、為提升董事酬金資訊透明度，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第32條規定，上市上櫃公司應於股東常會報告董事領取之酬金。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞董事會運作，為評鑑資訊依據。
G-2,公司是否於五月底前召開股東常會？,A,"一、為鼓勵公司儘早召開股東常會，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第5條規定，上市上櫃公司應於會計年度終了後六個月內召開股東常會。",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\議事手冊及會議補充資料，為評鑑資訊依據。
G-3,公司是否有董事長、過半數董事及審計委員會召集人親自出席股東常會，並於議事錄揭露出席名單？,A,"一、為鼓勵董事重視股東權益，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第5條規定，上市上櫃公司應於股東常會召開前，將股東會議事手冊及相關會議資料上傳至公開資訊觀測站。",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\議事手冊及會議補充資料\\議事錄，為評鑑資訊依據。
G-4,公司是否於股東常會開會30日前上傳中文版及英文版股東會議事手冊及會議補充資料，並於股東常會開會18日前上傳中文版及英文版年報？,A,"一、為鼓勵公司儘早提供股東會相關資料，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第5條規定，上市上櫃公司應於股東常會召開前，將股東會議事手冊及相關會議資料上傳至公開資訊觀測站。",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\議事手冊及會議補充資料\\議事錄，為評鑑資訊依據。
G-5,公司股東常會是否採線上直播或會後上傳全程不間斷錄音錄影，並於議事錄記載股東提問及公司回復之重要內容？,A,"一、為鼓勵公司利用科技提升股東會之透明度，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第8條規定，上市上櫃公司宜利用科技設備，提升股東會之透明度。",本指標以公司網站及公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\議事手冊及會議補充資料\\議事錄，為評鑑資訊依據。
G-6,公司於受評年度發放現金股利時，是否皆於除息基準日後30日內發放完畢？,A,"一、為鼓勵公司儘早發放現金股利，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第10條規定，上市上櫃公司應於除息基準日後30日內發放現金股利。",本指標以公開資訊觀測站\\重大訊息與公告\\重大訊息\\歷史重大訊息，為評鑑資訊依據。
G-7,公司是否設置公司治理主管，並於年報及網站揭露其職權範圍及受評年度之進修情形？,A,"一、為鼓勵公司設置公司治理主管，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第3條之1規定，上市上櫃公司應設置公司治理主管，負責公司治理相關事務。",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\年報，為評鑑資訊依據。
G-8,公司是否建置並揭露內部重大資訊處理作業程序？,A,"一、為鼓勵公司建立內部重大資訊處理作業程序，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第37條規定，上市上櫃公司應建立內部重大資訊處理作業程序，並揭露其執行情形。",本指標以公司網站為評鑑資訊依據。
G-9,公司是否訂定並於公司網站揭露禁止董事或員工等內部人利用市場上未公開資訊買賣有價證券之內部規範，內容包括（但不限於）董事不得於年度財務報告公告前三十日，和每季財務報告公告前十五日之封閉期間交易其股票，與說明執行情形？,A,"一、為鼓勵公司建立內部人交易規範，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第10條規定，上市上櫃公司應訂定內部人交易規範，並揭露其執行情形。",本指標以公司網站為評鑑資訊依據。
G-10,"公司是否未有單一法人組織及其子公司占董事會席次達三分之一以上？\n【額外加分要件請詳指標說明】",A+,"一、為避免單一法人控制董事會，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第20條規定，上市上櫃公司應避免單一法人控制董事會。\n【符合評鑑指標基本得分要件者於本構面計分；若單一法人組織及其子公司占董事會席次低於五分之一，則總分另加一分。】",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\年報，為評鑑資訊依據。
G-11,"公司是否訂定並揭露董事會成員多元化之政策、具體管理目標與落實情形？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司推動董事會成員多元化，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第20條規定，上市上櫃公司應建立董事會成員多元化政策，並揭露其執行情形，且定期（至少一年一次）向董事會報告。\n【符合評鑑指標基本得分要件者於本構面計分；若女性董事席次達三分之一以上，則總分另加一分。】",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞董事會運作，為評鑑資訊依據。
G-12,公司之董事長與總經理或其他相當職級者（最高經理人）是否非為同一人或互為配偶或一親等親屬？,A,"一、為避免公司權力過度集中，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第24條規定，上市上櫃公司之董事長與總經理或其他相當職級者（最高經理人）不宜由同一人擔任。",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\年報，為評鑑資訊依據。
G-13,公司之董事間是否不超過二人具有配偶或二親等以內之親屬關係，且具本公司、母、子或兄弟公司員工身分之人數，不超過董事席次三分之ㄧ？,A,"一、為避免公司權力過度集中，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第24條規定，上市上櫃公司之董事間應避免具有配偶或二親等以內之親屬關係。",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\年報，為評鑑資訊依據。
G-14,"公司獨立董事席次是否達董事席次三分之一以上？\n【額外加分要件請詳指標說明】",A+,"一、為強化董事會之獨立性，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第24條規定，上市上櫃公司應設置獨立董事，且其席次不得少於董事席次五分之一。\n【符合評鑑指標基本得分要件者於本構面計分；若獨立董事席次達二分之一以上，則總分另加一分。】",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\年報，為評鑑資訊依據。
G-15,公司獨立董事之連續任期是否皆不超過三屆？,A,"一、為強化獨立董事之獨立性，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第24條規定，上市上櫃公司之獨立董事連續任期不宜超過三屆。",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\年報，為評鑑資訊依據。
G-16,公司是否揭露審計委員會及薪資報酬委員會成員專業資格與經驗、年度工作重點及運作情形？,A,"一、為提升功能性委員會之透明度，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第28條規定，上市上櫃公司應於年報揭露審計委員會及薪資報酬委員會之成員專業資格與經驗、年度工作重點及運作情形。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞功能性委員會，為評鑑資訊依據。
G-17,公司是否訂定提名委員會組織規程，明定其成員由董事會推舉至少三人，其中應有過半數獨立董事參與，並揭露其成員專業資格與經驗、年度工作重點及運作情形？,A,"一、為提升董事提名之透明度，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第28條規定，上市上櫃公司應訂定提名委員會組織規程，並揭露其執行情形。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞功能性委員會，為評鑑資訊依據。
G-18,公司是否由審計委員會或董事會層級之功能性委員會（如風險管理委員會）督導風險管理，並訂定經董事會通過之風險管理政策與程序，揭露風險管理組織架構、風險管理程序及其運作情形，且至少一年一次向董事會報告？,A,"一、為鼓勵公司重視風險管理，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第37條之1規定，上市上櫃公司應訂定風險管理政策與程序，並揭露其執行情形，且定期（至少一年一次）向董事會報告。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞風險管理，為評鑑資訊依據。
G-19,公司訂定之董事會績效評估辦法是否經董事會通過，明定至少每三年執行外部評估ㄧ次，並已於受評年度或過去兩年度執行評估，且揭露執行情形及評估結果？,A,"一、為提升董事會運作效能，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第37條規定，上市上櫃公司應訂定董事會績效評估辦法，並揭露其執行情形。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞董事會運作，為評鑑資訊依據。
G-20,公司是否揭露獨立董事與內部稽核主管、會計師之單獨溝通情形（如就公司財務報告及財務業務狀況進行溝通之方式、事項及結果等）？,A,"一、為強化獨立董事與內部稽核主管、會計師之溝通，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第28條規定，上市上櫃公司應建立獨立董事與內部稽核主管、會計師之溝通機制。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞董事會運作，為評鑑資訊依據。
G-21,公司董事會是否定期（至少一年一次）參考審計品質指標（AQIs）評估簽證會計師獨立性及適任性，並詳實揭露評估程序？,A,"一、為提升簽證會計師之獨立性及適任性，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第29條規定，上市上櫃公司應定期評估簽證會計師之獨立性及適任性。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞審計品質，為評鑑資訊依據。
G-22,"公司之獨立董事是否均依「上市上櫃公司董事進修推行要點」規範之時數完成進修？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵獨立董事持續進修，爰訂定本指標。\n二、指標參考：上市上櫃公司董事進修推行要點第3點規定，上市上櫃公司之獨立董事應每年進修達一定時數。\n【符合評鑑指標基本得分要件者於本構面計分；若全體董事均依「上市上櫃公司董事進修推行要點」規範之時數完成進修，則總分另加一分。】",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞董事進修，為評鑑資訊依據。
G-23,"公司是否於股東常會開會18日前上傳以英文揭露之年度財務報告？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司儘早提供英文版財務報告，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第5條規定，上市上櫃公司應於股東常會召開前，將英文版財務報告上傳至公開資訊觀測站。\n【符合評鑑指標基本得分要件者於本構面計分；若於股東常會開會30日前上傳以英文揭露之年度財務報告，則總分另加一分。】",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\財務報告，為評鑑資訊依據。
G-24,公司是否於每月10日（含）前將內部人上月份持股變動之情形上傳至公開資訊觀測站？,A,"一、為提升內部人持股變動之透明度，爰訂定本指標。\n二、指標參考：證券交易法第25條規定，公開發行公司之內部人應於每月10日前申報上月份持股變動情形。",本指標以公開資訊觀測站\\董監股權異動\\董監股權異動\\董監事持股餘額明細資料，為評鑑資訊依據。
G-25,公司買回庫藏股且於受評年度期間屆滿或執行完畢者，是否有買回目的為轉讓予員工且平均執行率達90%以上，或於期間屆滿或執行完畢後揭露買回期間之每日實際執行情形？,A,"一、為提升庫藏股執行之透明度，爰訂定本指標。\n二、指標參考：上市上櫃公司買回本公司股份辦法第5條規定，上市上櫃公司應於買回期間屆滿或執行完畢後，揭露買回期間之每日實際執行情形。",本指標以公開資訊觀測站\\重大訊息與公告\\重大訊息\\歷史重大訊息，為評鑑資訊依據。
G-26,公司年報是否自願揭露董事之個別酬金？,A,"一、為提升董事酬金資訊透明度，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第32條規定，上市上櫃公司應於年報揭露董事之個別酬金。",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\年報，為評鑑資訊依據。
G-27,公司年報是否自願揭露總經理及副總經理之個別酬金？,A,"一、為提升經理人酬金資訊透明度，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第32條規定，上市上櫃公司應於年報揭露總經理及副總經理之個別酬金。",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\年報，為評鑑資訊依據。
G-28,公司中文及英文網站是否揭露主要股東名單、財務、業務及公司治理之相關資訊？,A,"一、為提升公司資訊透明度，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第37條規定，上市上櫃公司應於網站揭露公司治理相關資訊。",本指標以公司網站為評鑑資訊依據。
G-29,"公司是否受邀（自行）召開至少二次法人說明會，並揭露至少兩次完整之會議影音連結資訊，且受評年度首尾兩次法人說明會間隔三個月以上？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司定期召開法人說明會，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第37條規定，上市上櫃公司應定期召開法人說明會，並揭露會議相關資訊。\n【符合評鑑指標基本得分要件者於本構面計分；若受評年度受邀（自行）召開至少四次法人說明會，或受評年度首尾兩次法人說明會間隔三個月以上且至少一次由董事長或總經理親自主持，則總分另加一分。】",本指標以公開資訊觀測站\\重大訊息與公告\\法人說明會一覽表\\法人說明會影音連結資訊，為評鑑資訊依據。
G-30,"公司是否於會計年度結束後兩個月內公布年度財務報告？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司儘早公布年度財務報告，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第5條規定，上市上櫃公司應於會計年度結束後三個月內公布年度財務報告。\n【符合評鑑指標基本得分要件者於本構面計分；若於會計年度結束後75日內公布年度財務報告，則總分另加一分。】",本指標以公開資訊觀測站\\基本資料\\電子書\\年報及股東會相關資料（含存託憑證資料）\\財務報告，為評鑑資訊依據。
G-31,公司是否揭露高階經理人薪資報酬與ESG相關績效評估連結之政策？,A,"一、為鼓勵公司將ESG績效納入高階經理人薪資報酬評估，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第10條規定，上市上櫃公司應將ESG績效納入高階經理人薪資報酬評估。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞薪資報酬，為評鑑資訊依據。
G-32,公司是否定期揭露企業永續發展（ESG）之具體推動計畫與實施成效？,A,"一、為鼓勵公司揭露ESG推動計畫與成效，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第7條規定，上市上櫃公司應定期檢討ESG推動計畫與成效，並揭露於公司網站或年報。",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞永續發展，為評鑑資訊依據。
G-33,"公司是否參考SASB準則揭露行業指標資訊？\n【額外加分要件請詳指標說明】",A+,"一、為鼓勵公司依循SASB準則揭露資訊，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第29條規定，上市上櫃公司應參考國際準則，揭露ESG相關資訊。\n【符合評鑑指標基本得分要件者於本構面計分；若揭露之行業指標資訊取得第三方驗證，則總分另加一分。】",本指標以公開資訊觀測站－ESG數位平台＞ESG資訊揭露＞SASB，為評鑑資訊依據。
G-34,公司編製之永續報告書是否經提報董事會通過？,A,"一、為提升董事會對永續報告書之重視，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第29條規定，上市上櫃公司編製之永續報告書宜經董事會通過。",本指標以公開資訊觀測站－ESG數位平台＞永續報告書，為評鑑資訊依據。
G-35,公司編製之永續報告書是否取得第三方驗證？,A,"一、為鼓勵企業將編製之永續報告書取得第三方驗證，爰訂定本指標。\n二、指標參考：上市上櫃公司永續發展實務守則第29條規定，上市上櫃公司編製永續報告書應採用國際上廣泛認可之準則或指引，以揭露推動永續發展情形，並宜取得第三方確信或保證，以提高資訊可靠性；上市（櫃）公司編製與申報永續報告書作業辦法第3條第3項規定，上市公司應於永續報告書內揭露報告書內容對應GRI準則之內容索引，並於報告書內註明各揭露項目是否取得第三方確信或保證。",本指標以公開資訊觀測站－ESG數位平台＞永續報告書，為評鑑資訊依據。
G-36,公司是否上傳英文版永續報告書？,A,"一、為鼓勵企業發布英文版永續報告書，爰訂定本指標。\n二、指標參考：OECD原則IV.A.應揭露包括（但不限於）下列重要資訊：財務與營運成果、公司目標、主要股權及投票權、薪酬政策、關係人交易、可預見之風險因素、董事會成員及重要經理人、以及治理結構與政策等。",本指標以公開資訊觀測站－ESG數位平台＞永續報告書，為評鑑資訊依據。
額外\n加分題,公司是否於公司治理或永續發展領域有優良之表現，或於推動公司治理或永續發展已有具體效益？,A+,"一、為鼓勵公司於公司治理或永續發展領域有優良表現，爰訂定本指標。\n二、指標參考：上市上櫃公司治理實務守則第37條規定，上市上櫃公司應積極推動公司治理或永續發展，並揭露其具體效益。",本指標以公司網站、年報或永續報告書為評鑑資訊依據。
額外\n減分題,公司是否有重大違反誠信經營原則、企業社會責任、內部控制制度或其他不符公司治理原則之情事？,-,"一、為警惕公司遵守誠信經營原則及相關法規，爰訂定本指標。\n二、指標參考：上市上櫃公司誠信經營守則第20條規定，上市上櫃公司應避免發生不誠信行為，並對違反者採取適當之懲處措施。",本指標以主管機關裁罰紀錄、媒體報導等公開資訊為評鑑資訊依據。`;

        // --- 設定與常數 ---
        const WEIGHTS = { E: 0.21, S: 0.31, G: 0.48 };

        const CATEGORY_CONFIG = {
            E: { name: "環境面 (Environment)", icon: Sprout, color: "emerald", bg: "bg-emerald-100", text: "text-emerald-700", border: "border-emerald-200", ring: "ring-emerald-500" },
            S: { name: "社會面 (Social)", icon: Users, color: "sky", bg: "bg-sky-100", text: "text-sky-700", border: "border-sky-200", ring: "ring-sky-500" },
            G: { name: "治理面 (Governance)", icon: Scale, color: "violet", bg: "bg-violet-100", text: "text-violet-700", border: "border-violet-200", ring: "ring-violet-500" },
            P: { name: "額外減分", icon: ShieldAlert, color: "rose", bg: "bg-rose-100", text: "text-rose-700", border: "border-rose-200", ring: "ring-rose-500" }
        };

        const OFFICIAL_PENALTY_ITEMS = [
            { id: "P-1", category: "P", title: "違反證券交易法", point: 1, content: "受評年度公司或其負責人因違反證券交易法相關規定，經法院判決有罪者（包含緩刑）。" },
            { id: "P-2", category: "P", title: "財務報告更正", point: 1, content: "受評年度財務報告有更正或重編情事，情節重大者。" },
            { id: "P-3", category: "P", title: "內部控制重大缺失", point: 2, content: "受評年度內部控制制度有重大缺失，經會計師出具保留意見或否定意見者。" },
            { id: "P-4", category: "P", title: "違反法律規章", point: 1, content: "受評年度公司因違反環境保護、勞工、消費者保護等法律，經主管機關處分，情節重大者。" }
        ];

        // --- 機器人問答題庫 (FAQ Data) ---
        const BOT_FAQ = [
            { id: 'q1', label: '115年度新指標？', answer: '本系統為 115 年度 ESG 評鑑版本，指標依據最新 ESG 評鑑系統作業手冊，強調 E(環境)、S(社會)、G(治理) 三大構面之均衡發展。' },
            { id: 'q2', label: '分數如何計算？', answer: '115年度權重分配：\n環境面 (E)：21%\n社會面 (S)：31%\n治理面 (G)：48%' },
            { id: 'q3', label: '資料隱私安全嗎？', answer: '絕對安全！本系統為「純前端」運作，所有評鑑資料、佐證文字都只儲存在您的瀏覽器記憶體中，完全不會上傳到任何伺服器。' },
            { id: 'q4', label: '如何儲存和匯入進度？', answer: '點擊右上角「儲存進度」可下載 JSON 檔備份；下次使用時，在首頁點擊「2. 匯入 CSV 或進度檔」即可恢復。' },
            { id: 'q5', label: '如何匯出報告？', answer: '填寫完畢後，點擊右上角的「匯出報表」按鈕，系統會自動將您的填答結果整理成 CSV 表格供您下載。' },
            { id: 'q6', label: '什麼是額外減分？', answer: '針對重大違規事項（如違反證交法、財報更正等）的扣分機制。請至「額外減分」頁籤檢視。' },
        ];

        // --- 機器人組件 (Bot Component) ---
        const HelperBot = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([
                { id: 1, role: 'bot', text: '您好！我是 115自評系統小幫手 🤖。\n請問有什麼我可以協助您的嗎？' }
            ]);
            const [isTyping, setIsTyping] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages, isTyping, isOpen]);

            const handleQuestionClick = (faq) => {
                // 1. User Message
                const userMsgId = Date.now();
                setMessages(prev => [...prev, { id: userMsgId, role: 'user', text: faq.label }]);
                setIsTyping(true);

                // 2. Bot Response (Simulate delay)
                setTimeout(() => {
                    setIsTyping(false);
                    setMessages(prev => [...prev, { id: Date.now(), role: 'bot', text: faq.answer }]);
                }, 600);
            };

            return (
                <div className="fixed bottom-6 right-6 z-50 flex flex-col items-end pointer-events-none">
                    {/* Chat Window */}
                    {isOpen && (
                        <div className="pointer-events-auto mb-4 w-80 md:w-96 bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden flex flex-col animate-slide-up origin-bottom-right" style={{height: '500px'}}>
                            {/* Header - 使用 Blue 色系區隔 */}
                            <div className="bg-blue-600 p-4 flex justify-between items-center text-white shadow-sm">
                                <div className="flex items-center gap-2">
                                    <div className="bg-white/20 p-1.5 rounded-lg">
                                        <Bot size={20} className="text-white"/>
                                    </div>
                                    <div>
                                        <h3 className="font-bold text-sm">115自評系統小幫手</h3>
                                        <p className="text-[10px] text-blue-100 opacity-90">協助您了解最新 ESG 評鑑</p>
                                    </div>
                                </div>
                                <button onClick={() => setIsOpen(false)} className="hover:bg-white/20 p-1 rounded transition-colors">
                                    <X size={18} />
                                </button>
                            </div>

                            {/* Messages Area */}
                            <div className="flex-1 overflow-y-auto p-4 bg-slate-50 space-y-4">
                                {messages.map((msg) => (
                                    <div key={msg.id} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        {msg.role === 'bot' && (
                                            <div className="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-2 flex-shrink-0 border border-blue-200">
                                                <Bot size={14} className="text-blue-600"/>
                                            </div>
                                        )}
                                        <div className={`max-w-[80%] p-3 rounded-2xl text-sm leading-relaxed whitespace-pre-line shadow-sm ${
                                            msg.role === 'user' 
                                            ? 'bg-blue-600 text-white rounded-tr-none' 
                                            : 'bg-white text-slate-700 border border-slate-200 rounded-tl-none'
                                        }`}>
                                            {msg.text}
                                        </div>
                                    </div>
                                ))}
                                {isTyping && (
                                    <div className="flex justify-start">
                                        <div className="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-2 flex-shrink-0 border border-blue-200">
                                            <Bot size={14} className="text-blue-600"/>
                                        </div>
                                        <div className="bg-white p-3 rounded-2xl rounded-tl-none border border-slate-200 shadow-sm flex items-center gap-1">
                                            <div className="w-1.5 h-1.5 bg-slate-400 rounded-full typing-dot"></div>
                                            <div className="w-1.5 h-1.5 bg-slate-400 rounded-full typing-dot"></div>
                                            <div className="w-1.5 h-1.5 bg-slate-400 rounded-full typing-dot"></div>
                                        </div>
                                    </div>
                                )}
                                <div ref={messagesEndRef} />
                            </div>

                            {/* Quick Actions (Chips) */}
                            <div className="p-3 bg-white border-t border-slate-100 overflow-x-auto no-scrollbar">
                                <p className="text-xs text-slate-400 mb-2 font-bold px-1">建議提問：</p>
                                <div className="flex flex-col gap-2">
                                    {BOT_FAQ.map(faq => (
                                        <button 
                                            key={faq.id} 
                                            onClick={() => handleQuestionClick(faq)}
                                            disabled={isTyping}
                                            className="px-3 py-1.5 bg-slate-100 hover:bg-blue-50 hover:text-blue-600 hover:border-blue-200 border border-slate-200 rounded-lg text-xs font-medium transition-all text-left active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed w-full truncate"
                                        >
                                            {faq.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Floating Button - 使用 Blue 色系區隔 */}
                    <button 
                        onClick={() => setIsOpen(!isOpen)}
                        className={`pointer-events-auto p-4 rounded-full shadow-lg transition-all transform hover:scale-105 active:scale-95 flex items-center justify-center ${isOpen ? 'bg-slate-700 rotate-90' : 'bg-blue-600 hover:bg-blue-700 rotate-0'}`}
                    >
                        {isOpen ? <X size={24} className="text-white" /> : <MessageCircle size={24} className="text-white" />}
                    </button>
                </div>
            );
        };

        // CSV 解析器
        const parseCSVProfessional = (text) => {
            const rows = [];
            let currentRow = [];
            let currentVal = '';
            let insideQuote = false;
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                if (char === '"') {
                    if (insideQuote && text[i+1] === '"') { currentVal += '"'; i++; }
                    else { insideQuote = !insideQuote; }
                } else if (char === ',' && !insideQuote) {
                    currentRow.push(currentVal.trim()); currentVal = '';
                } else if ((char === '\r' || char === '\n') && !insideQuote) {
                    if (char === '\r' && text[i+1] === '\n') i++;
                    currentRow.push(currentVal.trim());
                    if (currentRow.length > 1 || currentRow[0] !== '') rows.push(currentRow);
                    currentRow = []; currentVal = '';
                } else { currentVal += char; }
            }
            if (currentVal || currentRow.length > 0) { currentRow.push(currentVal.trim()); rows.push(currentRow); }
            return rows;
        };

        function ESGSystem() {
            const [activeTab, setActiveTab] = useState("dashboard");
            const [indicators, setIndicators] = useState([]);
            const [penaltyItems, setPenaltyItems] = useState(OFFICIAL_PENALTY_ITEMS);
            const [answers, setAnswers] = useState({});
            const [penaltyAnswers, setPenaltyAnswers] = useState({});
            const [searchTerm, setSearchTerm] = useState("");
            const [expandedId, setExpandedId] = useState(null);
            const [hasData, setHasData] = useState(false); 
            const [showUnansweredOnly, setShowUnansweredOnly] = useState(false);
            const fileInputRef = useRef(null);
            
            // 防止重新整理導致資料遺失
            useEffect(() => {
                const handleBeforeUnload = (e) => {
                    if (hasData) {
                        e.preventDefault();
                        e.returnValue = '您有未儲存的評鑑資料，確定要離開嗎？';
                        return '您有未儲存的評鑑資料，確定要離開嗎？';
                    }
                };
                window.addEventListener('beforeunload', handleBeforeUnload);
                return () => window.removeEventListener('beforeunload', handleBeforeUnload);
            }, [hasData]);

            useEffect(() => {
                if (indicators.length === 0) return;
                setAnswers(prev => {
                    const next = { ...prev };
                    indicators.forEach(item => {
                        if (!next[item.id]) {
                            next[item.id] = { 
                                compliance: null, 
                                extraCredit: false, 
                                evidence: "", 
                                userNote: "", 
                                extraCreditNote: ""
                            };
                        }
                    });
                    return next;
                });
            }, [indicators]);

            const handleDownloadTemplate = () => {
                const fileName = '115_ESG_Indicator_Template.csv';
                // 使用內建的 OFFICIAL_TEMPLATE_CSV 產生 Blob
                const blob = new Blob([OFFICIAL_TEMPLATE_CSV], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.setAttribute('download', fileName);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleSaveProgress = () => {
                const data = {
                    timestamp: new Date().toISOString(),
                    indicators,
                    answers,
                    penaltyAnswers,
                    hasData: true
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `ESG_評鑑進度_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleExportCSV = () => {
                let csvContent = "\uFEFF編號,指標內容,符合情形,佐證說明,加分勾選,加分說明\n";
                
                indicators.forEach(item => {
                    const ans = answers[item.id] || {};
                    const status = ans.compliance === true ? "符合" : (ans.compliance === false ? "未達成" : "未填");
                    const extra = ans.extraCredit ? "是" : "否";
                    const safeText = (txt) => `"${(txt || "").replace(/"/g, '""')}"`;
                    
                    csvContent += `${item.id},${safeText(item.title)},${status},${safeText(ans.userNote)},${extra},${safeText(ans.extraCreditNote)}\n`;
                });

                penaltyItems.forEach(item => {
                    const ans = penaltyAnswers[item.id] || {};
                    const status = ans.isViolated ? "有違規 (扣分)" : "無違規";
                    const note = ans.note || "";
                    csvContent += `${item.id},${item.title},${status},${note},,\n`;
                });

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `ESG_評鑑結果報表_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleFileChange = (event) => {
                const file = event.target.files?.[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    const text = e.target?.result;
                    if (typeof text === 'string') {
                        if (file.name.endsWith('.json')) {
                            processJSON(text);
                        } else {
                            processCSV(text);
                        }
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            const processJSON = (jsonText) => {
                try {
                    const data = JSON.parse(jsonText);
                    if (data.indicators && data.answers) {
                        setIndicators(data.indicators);
                        setAnswers(data.answers);
                        if (data.penaltyAnswers) setPenaltyAnswers(data.penaltyAnswers);
                        setHasData(true);
                        setActiveTab("dashboard");
                        alert("進度載入成功！");
                    } else {
                        alert("檔案格式錯誤，請確認是否為本系統匯出之 JSON 檔。");
                    }
                } catch (err) {
                    console.error(err);
                    alert("JSON 讀取失敗。");
                }
            };

            const processCSV = (csvText) => {
                try {
                    const rows = parseCSVProfessional(csvText);
                    const newIndicators = [];
                    let isHeader = true;

                    // 檢測表頭是否包含 "前屆" (判斷是舊版還是新版)
                    // 如果表頭有 "前屆"，代表是舊格式 (6欄)
                    // 如果沒有，代表是新格式 (5欄)
                    let isOldFormat = false;
                    const headerRow = rows[0] || [];
                    if (headerRow.some(cell => cell.includes('前屆'))) {
                        isOldFormat = true;
                    }

                    rows.forEach(cols => {
                        if (cols.length < 2) return;
                        if (isHeader) {
                            if (cols.some(c => c.includes("編號") || c.includes("指標"))) {
                                if (!cols[0].match(/^[ESG]-\d+/)) { isHeader = false; return; }
                            }
                        }

                        const id = cols[0] || "";
                        if (!id.match(/^[ESG]-\d+/)) return;

                        let oldId = "";
                        let content = "";
                        let type = "A";
                        let note = "";
                        let evidenceSource = "";

                        if (isOldFormat) {
                            // 舊格式: ID, OldID, Content, Type, Note, Evidence
                            oldId = (cols[1] || "").toString();
                            content = (cols[2] || "").toString();
                            type = (cols[3] || "A").toString();
                            note = (cols[4] || "").toString();
                            evidenceSource = (cols[5] || "").toString();
                        } else {
                            // 新格式: ID, Content, Type, Note, Evidence
                            // (OldID 欄位已移除)
                            oldId = null; 
                            content = (cols[1] || "").toString();
                            type = (cols[2] || "A").toString();
                            note = (cols[3] || "").toString();
                            evidenceSource = (cols[4] || "").toString();
                        }
                        
                        let bonusCriteria = null;
                        if (type.includes("A+") && (note.includes("加一分") || note.includes("加分"))) {
                            const match = note.match(/【(.*?)加一分.*?】/) || note.match(/若(.*?)加一分/);
                            bonusCriteria = match ? match[0] : "請詳閱指標說明。";
                        }

                        newIndicators.push({
                            id, oldId, category: id.charAt(0),
                            title: content.length > 40 ? content.substring(0, 40) + "..." : content,
                            fullContent: content,
                            type, note, bonusCriteria, evidenceSource,
                            isNew: !oldId && isOldFormat // 只有在舊格式下才能判斷是否為 "New" (因新格式無舊ID)
                        });
                    });

                    if (newIndicators.length > 0) {
                        setIndicators(newIndicators);
                        setHasData(true);
                        setActiveTab("dashboard");
                        alert(`匯入成功！共解析出 ${newIndicators.length} 項指標。`);
                    } else {
                        alert("匯入失敗：未找到有效指標，請確認 CSV 格式。");
                    }
                } catch (err) {
                    console.error(err);
                    alert("檔案讀取發生錯誤，請檢查檔案編碼。");
                }
            };

            const stats = useMemo(() => {
                let raw = { E: 0, S: 0, G: 0 };
                let total = { E: 0, S: 0, G: 0 };
                let missing = { E: 0, S: 0, G: 0, Total: 0 }; 
                let bonus = 0, deduction = 0; 

                indicators.forEach(item => {
                    const ans = answers[item.id];
                    if (total[item.category] !== undefined) total[item.category]++;
                    
                    if (ans?.compliance === true) {
                        if (raw[item.category] !== undefined) raw[item.category]++;
                        if (item.type.includes("A+") && ans.extraCredit) bonus++;
                    } else if (ans?.compliance === null || ans?.compliance === undefined) {
                        if (missing[item.category] !== undefined) missing[item.category]++;
                        missing.Total++;
                    }
                });

                Object.values(penaltyAnswers).forEach(a => { if(a.isViolated) deduction += 1; });

                const score = (cat) => total[cat] ? (raw[cat] / total[cat]) * (WEIGHTS[cat] * 100) : 0;
                const totalScore = score('E') + score('S') + score('G') + bonus - deduction;

                return {
                    raw, total, missing,
                    weighted: { 
                        E: score('E').toFixed(2), S: score('S').toFixed(2), G: score('G').toFixed(2),
                        Base: (score('E') + score('S') + score('G')).toFixed(2),
                        Bonus: bonus, Deduction: deduction,
                        Total: Math.max(0, Math.min(totalScore, 100)).toFixed(2)
                    },
                    progress: indicators.length > 0 ? Math.round(((indicators.length - missing.Total) / indicators.length) * 100) : 0
                };
            }, [answers, indicators, penaltyAnswers]);

            const renderDashboard = () => (
                <div className="space-y-6 animate-fade-in">
                    <div className="bg-white p-8 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden">
                        <div className="flex flex-col md:flex-row items-center gap-8 relative z-10">
                            <div className="flex-1 text-center md:text-left">
                                <h3 className="text-slate-500 font-medium tracking-widest text-xs uppercase mb-2">Current Score</h3>
                                <div className="flex items-baseline justify-center md:justify-start gap-1">
                                    <span className="text-6xl font-black text-slate-900">{stats.weighted.Total}</span>
                                    <span className="text-xl text-slate-400">/ 100</span>
                                </div>
                                <div className="flex flex-wrap gap-3 mt-6 justify-center md:justify-start">
                                    <span className="px-3 py-1 bg-slate-100 rounded text-xs font-bold text-slate-600">基礎 {stats.weighted.Base}</span>
                                    <span className="px-3 py-1 bg-amber-50 rounded text-xs font-bold text-amber-700 border border-amber-100">+{stats.weighted.Bonus} 加分</span>
                                    <span className="px-3 py-1 bg-red-50 rounded text-xs font-bold text-red-700 border border-red-100">-{stats.weighted.Deduction} 減分</span>
                                </div>
                            </div>
                            <div className="flex flex-col items-center">
                                <div className="relative w-32 h-32 rounded-full flex items-center justify-center"
                                     style={{ background: `conic-gradient(#2563EB ${stats.progress}%, #F3F4F6 0)` }}>
                                    <div className="w-24 h-24 bg-white rounded-full flex flex-col items-center justify-center">
                                        <span className="text-2xl font-bold text-slate-800">{stats.progress}%</span>
                                        <span className="text-[10px] text-slate-400 uppercase">Completed</span>
                                    </div>
                                </div>
                                <div className="mt-4 text-sm font-bold text-slate-500">
                                    {stats.missing.Total > 0 ? (
                                        <span className="text-red-600 font-black bg-red-50 px-3 py-1 rounded-full">還有 {stats.missing.Total} 題未填答</span>
                                    ) : (
                                        <span className="text-blue-600 font-bold">已全數完成</span>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {['E', 'S', 'G'].map(cat => {
                            const cfg = CATEGORY_CONFIG[cat];
                            const Icon = cfg.icon;
                            return (
                                <div key={cat} className={`bg-white rounded-xl p-6 shadow-sm border border-slate-100 relative overflow-hidden`}>
                                    <div className={`w-10 h-10 rounded-lg ${cfg.bg} ${cfg.text} flex items-center justify-center mb-4`}>
                                        <Icon size={20} />
                                    </div>
                                    <h3 className="text-slate-500 text-sm font-bold">{cfg.name}</h3>
                                    <div className="text-2xl font-bold text-slate-900 mt-1">{stats.weighted[cat]}</div>
                                    <div className="text-xs text-slate-400 mt-2 flex justify-between">
                                        <span>權重 {WEIGHTS[cat]*100}%</span>
                                        <span>{stats.missing[cat] > 0 ? <span className="text-red-500 font-bold">{stats.missing[cat]} 題未填</span> : "完成"}</span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );

            const renderList = (cat) => {
                if (cat === 'P') {
                    return penaltyItems.map(item => {
                        const ans = penaltyAnswers[item.id] || { isViolated: false, note: "" };
                        const cfg = CATEGORY_CONFIG['P'];
                        return (
                            <div key={item.id} className={`bg-white border rounded-xl p-6 mb-4 transition-all ${ans.isViolated ? 'border-rose-400 shadow-md bg-rose-50/30' : 'border-slate-200'}`}>
                                <div className="flex flex-col md:flex-row justify-between items-start gap-4">
                                    <div className="flex-1">
                                        <div className="flex items-center gap-2 mb-2">
                                            <span className={`text-xs font-bold px-2 py-0.5 rounded ${cfg.bg} ${cfg.text} border ${cfg.border}`}>{item.id}</span>
                                            <span className="bg-slate-800 text-white text-xs font-bold px-2 py-0.5 rounded">扣 {item.point} 分</span>
                                        </div>
                                        <h4 className="font-bold text-slate-900 text-lg">{item.title}</h4>
                                        <p className="text-sm text-slate-600 mt-1">{item.content}</p>
                                    </div>
                                    <div className="flex bg-slate-100 p-1 rounded-lg shrink-0">
                                        <button onClick={() => setPenaltyAnswers(p => ({...p, [item.id]: {...p[item.id], isViolated: false}}))} 
                                            className={`px-4 py-2 rounded text-sm font-bold transition-all ${!ans.isViolated ? 'bg-white shadow text-emerald-600' : 'text-slate-400'}`}>
                                            無違規
                                        </button>
                                        <button onClick={() => setPenaltyAnswers(p => ({...p, [item.id]: {...p[item.id], isViolated: true}}))} 
                                            className={`px-4 py-2 rounded text-sm font-bold transition-all ${ans.isViolated ? 'bg-white shadow text-rose-600' : 'text-slate-400'}`}>
                                            有違規
                                        </button>
                                    </div>
                                </div>
                                {ans.isViolated && (
                                    <div className="mt-4 pt-4 border-t border-rose-200 animate-fade-in">
                                        <label className="block text-xs font-bold text-rose-700 mb-2">⚠️ 違規說明 / 改善措施 (必填)：</label>
                                        <textarea 
                                            className="w-full p-3 border border-rose-300 rounded-lg text-sm focus:ring-2 focus:ring-rose-500 focus:outline-none bg-white"
                                            rows="3"
                                            placeholder="請說明違規事項及具體改善計畫..."
                                            value={ans.note || ""}
                                            onChange={(e) => setPenaltyAnswers(p => ({...p, [item.id]: {...p[item.id], note: e.target.value}}))}
                                        ></textarea>
                                    </div>
                                )}
                            </div>
                        );
                    });
                }

                const list = indicators.filter(i => i.category === cat && (
                    i.title.includes(searchTerm) || i.fullContent.includes(searchTerm) || i.id.includes(searchTerm)
                )).filter(i => !showUnansweredOnly || answers[i.id]?.compliance === null);

                if (list.length === 0) return <div className="text-center py-10 text-slate-400 bg-white rounded-xl border border-slate-200">無符合指標</div>;

                return list.map(item => {
                    const ans = answers[item.id] || {};
                    const isExpanded = expandedId === item.id;
                    const cfg = CATEGORY_CONFIG[item.category];

                    return (
                        <div key={item.id} className={`bg-white border rounded-xl mb-4 transition-all duration-200 ${ans.compliance === true ? `border-${cfg.color}-400 shadow-sm` : ans.compliance === false ? 'border-slate-300 bg-slate-50/50' : 'border-slate-200 hover:border-indigo-300'}`}>
                            <div className="p-5 cursor-pointer flex flex-col md:flex-row gap-4 items-start" onClick={() => setExpandedId(isExpanded ? null : item.id)}>
                                <div className={`w-12 h-12 rounded-lg flex-shrink-0 flex flex-col items-center justify-center font-bold text-sm border ${cfg.bg} ${cfg.text} ${cfg.border}`}>
                                    <span>{item.id}</span>
                                </div>
                                
                                <div className="flex-1">
                                    <div className="flex flex-wrap gap-2 mb-1.5 items-center">
                                        {item.oldId && <span className="bg-slate-100 text-slate-500 text-[10px] font-medium px-2 py-0.5 rounded border border-slate-200">前屆: {item.oldId}</span>}
                                        {item.isNew && <span className="bg-rose-100 text-rose-700 text-[10px] font-bold px-2 py-0.5 rounded border border-rose-200">New</span>}
                                        {item.type.includes("A+") && <span className="bg-amber-100 text-amber-800 text-[10px] font-bold px-2 py-0.5 rounded border border-amber-200">A+ Bonus</span>}
                                    </div>
                                    <h4 className="font-bold text-slate-900 text-base leading-snug mb-1">{item.title}</h4>
                                    <p className="text-sm text-slate-500 line-clamp-2">{item.fullContent}</p>
                                </div>

                                <div className="flex gap-2 shrink-0" onClick={e => e.stopPropagation()}>
                                    <button onClick={() => setAnswers(p => ({...p, [item.id]: {...p[item.id], compliance: true}}))}
                                        className={`px-4 py-2 rounded-lg text-sm font-bold border transition-all flex items-center gap-1 ${ans.compliance === true ? `bg-${cfg.color}-600 text-white border-${cfg.color}-600 shadow-md` : `bg-white text-slate-400 hover:border-${cfg.color}-300`}`}>
                                        <CheckCircle size={16}/> 符合
                                    </button>
                                    <button onClick={() => setAnswers(p => ({...p, [item.id]: {...p[item.id], compliance: false, extraCredit: false}}))}
                                        className={`px-4 py-2 rounded-lg text-sm font-bold border transition-all flex items-center gap-1 ${ans.compliance === false ? 'bg-slate-600 text-white border-slate-600 shadow-md' : 'bg-white text-slate-400 hover:border-slate-300'}`}>
                                        <XCircle size={16}/> 未達成
                                    </button>
                                </div>
                            </div>

                            {isExpanded && (
                                <div className="px-6 pb-6 pt-0 animate-fade-in">
                                    <div className="bg-slate-50 p-5 rounded-xl border border-slate-100 space-y-4">
                                        <div className="flex gap-3 items-start">
                                            <Info size={18} className="mt-1 flex-shrink-0 text-indigo-500" />
                                            <div className="text-sm text-slate-700 leading-relaxed w-full">
                                                <p className="font-bold text-slate-900 mb-1">指標完整內容與說明：</p>
                                                <div className="whitespace-pre-wrap mb-2">{item.fullContent}</div>
                                                <hr className="border-slate-200 my-2"/>
                                                <div className="whitespace-pre-wrap text-slate-600">{item.note}</div>
                                                
                                                {item.evidenceSource && (
                                                    <div className="mt-3 flex items-center gap-2 text-xs font-medium text-slate-500 bg-white px-3 py-2 rounded border border-slate-200 inline-block">
                                                        <BookOpen size={14}/> 評鑑資訊依據：{item.evidenceSource}
                                                    </div>
                                                )}
                                            </div>
                                        </div>

                                        <div className="pl-8">
                                            <label className="block text-xs font-bold text-slate-600 mb-2">📝 自評說明 / 佐證資料連結：</label>
                                            <textarea 
                                                className="w-full p-3 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:outline-none bg-white"
                                                rows="2"
                                                placeholder="請輸入佐證頁碼、連結或內部說明..."
                                                value={ans.userNote || ""}
                                                onChange={(e) => setAnswers(p => ({...p, [item.id]: {...p[item.id], userNote: e.target.value}}))}
                                            ></textarea>
                                        </div>

                                        {item.type.includes("A+") && (
                                            <div className={`mt-4 p-4 rounded-lg border transition-all ${ans.compliance ? 'bg-amber-50 border-amber-200' : 'bg-slate-100 border-slate-200 opacity-60'}`}>
                                                <label className="flex items-center gap-2 cursor-pointer mb-3">
                                                    <input type="checkbox" checked={ans.extraCredit} disabled={!ans.compliance}
                                                        onChange={e => setAnswers(p => ({...p, [item.id]: {...p[item.id], extraCredit: e.target.checked}}))}
                                                        className="w-5 h-5 text-amber-600 rounded focus:ring-amber-500 border-gray-300 cursor-pointer" />
                                                    <span className={`font-bold ${ans.compliance ? 'text-amber-800' : 'text-slate-500'}`}>符合進階加分條件 (+1分)</span>
                                                </label>
                                                
                                                {item.bonusCriteria && <div className="ml-7 mb-3 text-xs text-amber-800 bg-white/50 p-2 rounded border border-amber-100"><strong>條件：</strong>{item.bonusCriteria}</div>}
                                                
                                                {ans.extraCredit && (
                                                    <div className="ml-7 animate-fade-in">
                                                        <label className="block text-xs font-bold text-amber-700 mb-1">➕ 進階加分達成情形說明：</label>
                                                        <textarea 
                                                            className="w-full p-2 border border-amber-300 rounded-lg text-sm focus:ring-2 focus:ring-amber-500 focus:outline-none bg-white"
                                                            rows="2"
                                                            placeholder="請說明符合加分條件之具體作為..."
                                                            value={ans.extraCreditNote || ""}
                                                            onChange={(e) => setAnswers(p => ({...p, [item.id]: {...p[item.id], extraCreditNote: e.target.value}}))}
                                                        ></textarea>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}
                        </div>
                    );
                });
            };

            if (!hasData) return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-slate-50">
                    <div className="max-w-4xl w-full text-center">
                        <h1 className="text-3xl font-black text-slate-800 mb-2">115年度 ESG 評鑑自評系統</h1>
                        <p className="text-slate-500 mb-10">遵循證交所發布之最新指標，協助企業進行高效自評</p>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto">
                            <div className="bg-white p-8 rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-all text-center group cursor-pointer" onClick={handleDownloadTemplate}>
                                <div className="w-16 h-16 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                                    <DownloadCloud size={32} />
                                </div>
                                <h3 className="font-bold text-lg text-slate-900">1. 下載指標原始檔</h3>
                                <p className="text-xs text-slate-400 mt-2">按此下載最新版 CSV (無前屆編號)。下載後請執行步驟 2 匯入。</p>
                            </div>
                            <div className="bg-white p-8 rounded-2xl border border-emerald-200 shadow-md hover:shadow-lg transition-all text-center group cursor-pointer relative overflow-hidden" onClick={() => fileInputRef.current.click()}>
                                <div className="absolute top-0 right-0 bg-emerald-600 text-white text-[10px] font-bold px-2 py-1 rounded-bl-lg">START</div>
                                <div className="w-16 h-16 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                                    <Upload size={32} />
                                </div>
                                <h3 className="font-bold text-lg text-slate-900">2. 匯入 CSV 或進度檔</h3>
                                <p className="text-xs text-slate-400 mt-2">支援 .csv (題目) 或 .json (進度)</p>
                            </div>
                        </div>
                        <input type="file" ref={fileInputRef} onChange={handleFileChange} className="hidden" accept=".csv,.txt,.json" />

                        {/* 資料來源與版權聲明 - 僅在起始畫面顯示 */}
                        <div className="mt-16 max-w-2xl mx-auto text-[11px] text-slate-400 leading-relaxed border-t border-slate-200 pt-6">
                            <p className="mb-2 font-bold text-slate-500">
                                資料來源與版權聲明
                            </p>
                            <p>
                                本系統之評鑑指標、權重配分與評核標準，皆依據 <a href="https://cgc.twse.com.tw/esgEvaluation/listCh" target="_blank" className="hover:text-slate-600 underline decoration-slate-300 underline-offset-2 transition-colors">臺灣證券交易所公司治理中心 (Corporate Governance Center, TWSE)</a> 公布之《115年度 ESG 評鑑系統作業手冊》及相關修正說明辦理。
                            </p>
                            <p className="mt-1">
                                相關資料版權歸屬臺灣證券交易所所有，本系統僅提供輔助自評功能。
                            </p>
                        </div>
                    </div>
                    {/* Bot 在 Empty State 也要顯示 */}
                    <HelperBot />
                </div>
            );

            return (
                <div className="min-h-screen bg-slate-50/50 pb-12">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-30 shadow-sm/50 backdrop-blur-md bg-white/90">
                        <div className="max-w-5xl mx-auto px-4">
                            <div className="flex justify-between h-16 items-center">
                                <div className="flex items-center gap-3 font-bold text-slate-800">
                                    <div className="bg-blue-600 text-white p-1.5 rounded-lg"><FileText size={20}/></div>
                                    115年度 ESG 評鑑
                                </div>
                                <div className="flex gap-2 text-sm font-medium text-slate-500">
                                    <button onClick={handleSaveProgress} className="hover:text-blue-600 flex items-center gap-1 px-3 py-1.5 rounded-lg border border-slate-200 bg-white hover:bg-slate-50 shadow-sm transition-all">
                                        <Save size={14}/> 儲存進度
                                    </button>
                                    <button onClick={handleExportCSV} className="hover:text-blue-600 flex items-center gap-1 px-3 py-1.5 rounded-lg border border-slate-200 bg-white hover:bg-slate-50 shadow-sm transition-all">
                                        <HardDriveDownload size={14}/> 匯出報表
                                    </button>
                                    <button onClick={() => {if(confirm('確定要重置並重新匯入嗎？未儲存的資料將會遺失。')) window.location.reload()}} className="hover:text-rose-600 flex items-center gap-1 px-3 py-1.5 rounded-lg hover:bg-rose-50 transition-all text-slate-400" title="重置系統">
                                        <LogOut size={14}/>
                                    </button>
                                </div>
                            </div>
                            <div className="flex gap-6 overflow-x-auto no-scrollbar">
                                {['dashboard', 'E', 'S', 'G', 'P'].map(tab => {
                                    const cfg = CATEGORY_CONFIG[tab] || {name: "總覽", color: "slate"};
                                    const isActive = activeTab === tab;
                                    const activeClass = isActive ? `border-${cfg.color}-500 text-${cfg.color}-700` : 'border-transparent text-slate-400 hover:text-slate-600';
                                    return (
                                        <button key={tab} onClick={() => setActiveTab(tab)} 
                                            className={`pb-3 text-sm font-bold border-b-2 transition-colors whitespace-nowrap flex items-center gap-2 ${activeClass}`}>
                                            {tab === 'dashboard' ? '總覽儀表板' : cfg.name}
                                            {stats.missing[tab] > 0 && <span className="bg-rose-100 text-rose-600 text-[10px] px-1.5 rounded-full">{stats.missing[tab]}</span>}
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    </header>
                    
                    <main className="max-w-5xl mx-auto px-4 py-8">
                        {activeTab === 'dashboard' ? renderDashboard() : (
                            <div className="animate-fade-in">
                                <div className="flex justify-between items-center mb-6">
                                    <div className="relative w-full md:w-64">
                                        <Search className="absolute left-3 top-2.5 text-slate-400" size={16}/>
                                        <input type="text" placeholder="搜尋..." className="pl-9 w-full py-2 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" value={searchTerm} onChange={e => setSearchTerm(e.target.value)}/>
                                    </div>
                                    <label className="flex items-center gap-2 text-sm font-bold text-slate-600 cursor-pointer">
                                        <input type="checkbox" checked={showUnansweredOnly} onChange={e => setShowUnansweredOnly(e.target.checked)} className="accent-blue-600"/>
                                        只顯示未填答
                                    </label>
                                </div>
                                {renderList(activeTab)}
                            </div>
                        )}
                    </main>

                    <footer className="border-t border-slate-200 py-8 text-center text-slate-400 text-xs">
                        <div className="flex items-center justify-center gap-1 mb-2">
                            <Info size={12} /> 資料來源：
                            <a href="https://cgc.twse.com.tw/esgEvaluation/listCh" target="_blank" className="text-blue-600 hover:underline">臺灣證券交易所公司治理中心</a>
                        </div>
                        © 115年度 ESG 評鑑自評系統
                    </footer>
                    
                    <HelperBot />
                    <input type="file" ref={fileInputRef} onChange={handleFileChange} className="hidden" accept=".csv,.txt,.json" />
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<ESGSystem />);
    </script>
</body>
</html>
